<html> 
<head>
    <title>My Amazing HIT</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="mturk.js"></script>
    <script>
    	var numclicks = 0;
    	var keydowns = 0;

      var addedelements = [];

    	$(document).ready(function() {
    		$("#theimage").click(function(e) {
          numclicks++;
          $("#numberofpeople").text(numclicks);
          $("#numberofpeoplefield").val(numclicks);

          var newdomelement = $("<div class='marker'></div>");
          newdomelement.css("left", (e.pageX-3) + "px");
          newdomelement.css("top", (e.pageY-3) + "px");

          var currhistory = $("#history").val();
          currhistory += "|" + e.pageX + "," + e.pageY + "|";
          $("#history").val(currhistory);

          newdomelement.click(removeElementEvent);

          $("body").append(newdomelement);

          // add to history
          addedelements.push(newdomelement);
    		})
    		$(document).keydown(function(e) {
    			keydowns++;
    			$("#numkeydowns").val(keydowns);

          console.log(e);

          if(e.key=="z" && e.ctrlKey) {
            var elem2remove = addedelements.pop();
            removeElement(elem2remove);
          }
    		})
    	})

      function removeElement(elem) {
        $(elem).remove();
        if(numclicks > 0){
        	numclicks--;
	}
        $("#numberofpeople").text(numclicks);
        $("#numberofpeoplefield").val(numclicks);       
      }

      function removeElementEvent(e) {
        removeElement(this);
      }
    </script>
  <style>
    .marker {
      border: 2px solid red;
      border-radius: 5px;
      width: 2px;
      height: 2px;
      position: absolute;
      left: 0px;
      top: 0px;
    }
  </style>
</head>
<body>
<h2>Count number of people in seven images and earn up to 2.2 dollars: Rewardable Experiment!</h2> 
<h3>Greetings from Weiqi</h3>
<p>
<img src="/images/pikachu.png" width="75" height="75"/>
</p>
<h3><font color="blue">Please spend a minute and read the following instructions carefully before you start the HIT, It's worth it:</font></h3>
<p>
<strong>1. Please press on the bottom <font color="blue">"Accept HIT"</font> before you start, or else your answer may not be recorded!</strong><br>
<strong>2. Number of people in all seven test images(test images 1-7) have to be counted or else the submit will not be accepted.</strong><br>
3. Please type the number of recognizable human-being in the text boxes below for test images 1-6.<br>
4. For image 7, you do not need to type inside a text box, what you need to do is to click on faces inside the image,
   a little red circle will emerge and the counter will automatically count for you.<br>
   If you want to undo because of error clicking, simply click on the red circle you mis-clicked or press (Ctrl+Z), either will help you out.<br>
5. The rule for valid people in following images is that there should be more than half of the head shown within the border of the image and he/she should be a real person(mirage is not counted).<br>
6. There are two counting examples below to help you understand the rule above.<br>
7. Getting correct answers for test image 1-6 will earn you $0.20 as they are relatively simple.<br>
8. For test image 7, if you get the answer within an error rate of 3%, you will earn an extra $2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if you get the answer within an error rate of 10%, you will earn an extra $1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if you get the answer within an error rate of 30%, you will earn an extra $0.30<br>
9. This is a rewardable experiment, spend ten minutes, have fun and earn the <strong>$2.2</strong>, good luck!
</p>
<br>
<fieldset>
<legend><strong>Two Examples for two counted images</strong></legend>
Example image 1:<br>
<p>
<img src="/images/examplepeople1.jpg" width="auto" height="400"/>
</p>
Number of recognizable people in example image 1: <font color="blue">9</font>
<br><br>
Example image 2:<br>
<p>
<img src="/images/examplepeople2.jpg" width="auto" height="400"/>
</p>
Number of recognizable people in example image 2: <font color="blue">1</font>
<br> 
</fieldset>
<br><br>
<form id="mturk_form">
<fieldset>
<legend><strong>Task: How many recognizable people are there in each test image?</strong></legend>
<p>
Test image 1:<br>
<img src="/images/people1.jpg" width="auto" height="400"/>
</p>
Number of recognizable people in test image 1:
<input type = "text" name = "number of people in test image 1">
<p>
<br><br>
Test image 2:<br>
<img src="/images/people2.jpg" width="auto" height="400"/>
</p>
Number of recognizable people in test image 2:
<input type = "text" name = "number of people in test image 2">
<p>
<br><br>
Test image 3:<br>
<img src="/images/people3.jpg" width="auto" height="400"/>
</p>
Number of recognizable people in test image 3:
<input type = "text" name = "number of people in test image 3">
<p>
<br><br>
Test image 4:<br>
<img src="/images/people4.jpg" width="auto" height="400"/>
</p>
Number of recognizable people in test image 4:
<input type = "text" name = "number of people in test image 4">
<p>
<br><br>
<font color="blue">Half Way Done! Keep on! ^_^</font><br><br>
Test image 5:<br>
<img src="/images/people5.png" width="auto" height="400"/>
</p>
Number of recognizable people in test image 5:
<input type = "text" name = "number of people in test image 5">
<p>
<br><br>
Test image 6:<br>
<img src="/images/people6.jpg" width="auto" height="400"/>
</p>
Number of recognizable people in test image 6:
<input type = "text" name = "number of people in test image 6">
<p>
<br><br>
<strong>Final task: Test image 7: spend some time and earn an extra $2</strong><br>
Tips: Click on faces, little red circles will emerge and the counter below will automatically count,<br>
      No need to type in text box for this task, you can undo by either pressing on mis-clicked circles or pressing (Ctrl+Z) <br>
      You could enlarge the image for convenience.<br>
<img id="theimage" src="/images/people7.jpg">
<p>
You've selected <span id="numberofpeople">0</span> people.
</p>
<br>
Congratulations! Please check and then submit, good luck!
<p>
  <input id="numclickfield" type="hidden" name="numclicks">
  <input id="numkeydowns" type="hidden" name="keydowns">
  <input id="numberofpeoplefield" type="hidden" name="numberofpeople">
  <input id="history" type="hidden" name="history">
  <input type="submit" name="Submit Counting task" value = "Submit">
</p>
</fieldset>
</form>
</body>
</html>